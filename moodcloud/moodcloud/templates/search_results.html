<!doctype html>
<html>
    <head>
      {% load staticfiles %}
      <meta charset='utf-8'>
      <meta http-equiv="X-UA-Compatible" content="chrome=1">
      <link rel="stylesheet" type="text/css" href="https://code.jquery.com/ui/1.10.4/themes/smoothness/jquery-ui.css" media="screen" />
      <link rel="stylesheet" type="text/css" href="{% static 'css/stylesheet.css' %}" media="screen" />
      <link rel="stylesheet" type="text/css" href="{% static 'css/col.css' %}" />
      <link rel="stylesheet" type="text/css" href="{% static 'css/2cols.css' %}" />
      <link rel="stylesheet" type="text/css" href="{% static 'css/flaticon.css' %}" />
      <link rel="stylesheet" type="text/css" href="{% static 'css/ledstrip.css' %}" />
      <!--[if lt IE 9]>
          <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
      <![endif]-->
      <script src="http://code.jquery.com/jquery-1.11.0.min.js"></script>
      <script src="https://code.jquery.com/ui/1.10.4/jquery-ui.min.js"></script>
      <script type="text/javascript" src="{% static 'js/ledstrip.js' %}"></script>
      <script type="text/javascript" src="{% static 'js/rAF.js' %}"></script>
      <script type="text/javascript" src="{% static 'js/ws2812.js' %}"></script>
      <title>MoodCloud</title>
    </head>

    <body>
        <div id="content" class="wrapper">
            <div id="back_home" style="float: left">
                <div style="text-align: center">
                    <a href="/">
                        <img src="{% static 'img/Button_Back.png' %}">
                        <p><strong>SEARCH AGAIN?</strong></p>
                    </a>
                </div>
            </div>

            <header class="results_home_header"><h2 style="font-variant: small-caps">ON: "{{Result.search_term}}"</h2></header>

            <div class="LEDBox">
                <div class="simulation">
                    <div class="ledstrip">1</div>
                    <div class="ledstrip">2</div>
                    <div class="ledstrip">3</div>
                    <div class="ledstrip">4</div>
                    <div class="ledstrip">5</div>
                    <div class="ledstrip">6</div>
                    <div class="ledstrip">7</div>
                    <div class="ledstrip">8</div>
                    <div class="ledstrip">9</div>
                    <div class="ledstrip">10</div>
                    <div class="ledstrip">11</div>
                    <div class="ledstrip">12</div>
                    <div class="ledstrip">13</div>
                    <div class="ledstrip">14</div>
                    <div class="ledstrip">15</div>
                    <div class="ledstrip">16</div>
                </div>
            </div>
            <div id="topic_list" style="text-align: center">
                <div style="width: 25%;float:left">
                    <ol start="1" style="text-align: left">
                        <li><a href="" class="topic_1">{{Result.topics.all.0.topic}}</a></li>
                        <li><a href="" class="topic_2">{{Result.topics.all.1.topic}}</a></li>
                        <li><a href="" class="topic_3">{{Result.topics.all.2.topic}}</a></li>
                        <li><a href="" class="topic_4">{{Result.topics.all.3.topic}}</a></li>
                    </ol>
                </div>
                <div style="width: 25%;float:left">
                    <ol start="5" style="text-align: left">
                        <li><a href="" class="topic_5">{{Result.topics.all.4.topic}}</a></li>
                        <li><a href="" class="topic_6">{{Result.topics.all.5.topic}}</a></li>
                        <li><a href="" class="topic_7">{{Result.topics.all.6.topic}}</a></li>
                        <li><a href="" class="topic_8">{{Result.topics.all.7.topic}}</a></li>
                    </ol>
                </div>
                <div style="width: 25%;float:left">
                    <ol start="9" style="text-align: left">
                        <li><a href="" class="topic_9">{{Result.topics.all.8.topic}}</a></li>
                        <li><a href="" class="topic_10">{{Result.topics.all.9.topic}}</a></li>
                        <li><a href="" class="topic_11">{{Result.topics.all.10.topic}}</a></li>
                        <li><a href="" class="topic_12">{{Result.topics.all.11.topic}}</a></li>
                    </ol>
                </div>
                <div style="width: 25%;float:left">
                    <ol start="13" style="text-align: left">
                        <li><a href="" class="topic_13">{{Result.topics.all.12.topic}}</a></li>
                        <li><a href="" class="topic_14">{{Result.topics.all.13.topic}}</a></li>
                        <li><a href="" class="topic_15">{{Result.topics.all.14.topic}}</a></li>
                        <li><a href="" class="topic_16">{{Result.topics.all.15.topic}}</a></li>
                    </ol>
                </div>
            </div>
            <div>
                <p id="key"><strong>WHAT DO THE COLORS MEAN?</strong></p>
                <div style="width:25%;float: left">
                    <div><div class="circle" style="background-color: #07B918;"></div>&nbsp;<span style="color:#07B918;float:left;line-height:18px;margin-left:5px;vertical-align:middle">Joviality</span></div>
                    <div><div class="circle" style="background-color: #953735"></div>&nbsp;<span style="color:#953735;float:left;line-height:18px;margin-left:5px;vertical-align:middle">Fatigue</span></div>
                </div>
                <div style="width:25%;float: left">
                    <div><div class="circle" style="background-color: #E10000"></div>&nbsp;<span style="color:#E10000;float:left;line-height:18px;margin-left:5px;vertical-align:middle">Hostility</span></div>
                    <div><div class="circle" style="background-color: #21375E"></div>&nbsp;<span style="color:#21375E;float:left;line-height:18px;margin-left:5px;vertical-align:middle">Sadness</span></div>
                </div>
                <div style="width:25%;float: left">
                    <div><div class="circle" style="background-color: #31859C"></div>&nbsp;<span style="color:#31859C;float:left;line-height:18px;margin-left:5px;vertical-align:middle">Serenity</span></div>
                    <div><div class="circle" style="background-color: #E1B700"></div>&nbsp;<span style="color:#E1B700;float:left;line-height:18px;margin-left:5px;vertical-align:middle">Fear</span></div>
                </div>
                <div style="width:25%;float: left">
                    <div><div class="circle" style="background-color: #E06B0A"></div>&nbsp;<span style="color:#E06B0A;float:left;line-height:18px;margin-left:5px;vertical-align:middle">Guilt</span></div>
                </div>
            </div>
        </div>

        <script type="text/javascript">
            var strip = new Array();
            var animation = new Array(); // need to be global

            function executeQuery() {
                $.ajax({
                url: '/data/',
                success: function(data) {
                    if (data) {
                        if (data.hasOwnProperty('fields') && data['fields'].hasOwnProperty('topics')) {
                            for(var i=0; i<data['fields']['topics'].length; i++) {
                            var topic = data['fields']['topics'][i]['fields'];
                                var hex = topic['mood']['fields']['html_color'];
                                var rgb = [parseInt(hex.slice(1,3), 16), parseInt(hex.slice(3,5), 16), parseInt(hex.slice(5), 16)];
                                var topic_text = topic['topic'];
                                $('.topic_'+(i+1)).text(topic_text);
                                strip[i].clear();
                                for (var j=0;j<6;j++) {
                                    var idx = i*6+j;
                                    strip[i].buffer[j] = rgb;
                                    var s = $(".ledstrip")[i];
                                    var l = $(s).find(".WS2812-led")[j];
                                    l.title = topic_text;
                                }
                                strip[i].send();
                                }
                            }
                            }
                    //console.log("Updated from whooly.");
                    },
                    error: function() {
                    console.log("There was an error retrieving data for moodcloud.");
                    }
                });
            }

            $(document).ready(function(){
              $('.ledstrip').each(function(index, value) {
                strip[index] = LEDstrip(value, 6, "vertical");
              });
              $().tooltip();
              setInterval(executeQuery, 1000);
            });
        </script>
    </body>
</html>