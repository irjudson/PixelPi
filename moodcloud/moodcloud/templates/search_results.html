<!doctype html>
<html>
<head>
  {% load staticfiles %}
  <meta charset='utf-8'>
  <meta http-equiv="X-UA-Compatible" content="chrome=1">
  <link rel="stylesheet" type="text/css" href="https://code.jquery.com/ui/1.10.4/themes/smoothness/jquery-ui.css" media="screen" />
  <link rel="stylesheet" type="text/css" href="{% static 'css/stylesheet.css' %}" media="screen" />
  <link rel="stylesheet" type="text/css" href="{% static 'css/col.css' %}" />
  <link rel="stylesheet" type="text/css" href="{% static 'css/2cols.css' %}" />
  <link rel="stylesheet" type="text/css" href="{% static 'css/flaticon.css' %}" />
  <link rel="stylesheet" type="text/css" href="{% static 'css/ledstrip.css' %}" />
  <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <script src="http://code.jquery.com/jquery-1.11.0.min.js"></script>
  <script src="https://code.jquery.com/ui/1.10.4/jquery-ui.min.js"></script>
  <script type="text/javascript" src="{% static 'js/ledstrip.js' %}"></script>
  <script type="text/javascript" src="{% static 'js/rAF.js' %}"></script>
  <script type="text/javascript" src="{% static 'js/ws2812.js' %}"></script>

  <title>MoodCloud</title>
</head>

<body>
    <div id="container">
    <div class="inner">
        <div id="back_home" style="float: left;text-align: center">
        <a href="/">
            <i class="flaticon-left37"></i> 
            <p style="font-size: x-small;margin-left:20px"><strong>SEARCH<br/>AGAIN?</strong></p>
        </a>
        </div>
        <header>
            <h1>moodcloud</h1>
            <h3>ON "{{Result.search_term}}"</h3>
        </header>

        <div id="content">
        <div class="LEDBox">
            <div class="simulation">
            <div class="ledstrip"><div id="topic_label" class="rot-neg-90"><strong>test</strong></div></div>
            <div class="ledstrip"><div id="topic_label" class="rot-neg-90"><strong>test</strong></div></div>
            <div class="ledstrip"><div id="topic_label" class="rot-neg-90"><strong>test</strong></div></div>
            <div class="ledstrip"><div id="topic_label" class="rot-neg-90"><strong>test</strong></div></div>
            <div class="ledstrip"><div id="topic_label" class="rot-neg-90"><strong>test</strong></div></div>
            <div class="ledstrip"><div id="topic_label" class="rot-neg-90"><strong>test</strong></div></div>
            <div class="ledstrip"><div id="topic_label" class="rot-neg-90"><strong>test</strong></div></div>
            <div class="ledstrip"><div id="topic_label" class="rot-neg-90"><strong>test</strong></div></div>
            <div class="ledstrip"><div id="topic_label" class="rot-neg-90"><strong>test</strong></div></div>
            <div class="ledstrip"><div id="topic_label" class="rot-neg-90"><strong>test</strong></div></div>
            <div class="ledstrip"><div id="topic_label" class="rot-neg-90"><strong>test</strong></div></div>
            <div class="ledstrip"><div id="topic_label" class="rot-neg-90"><strong>test</strong></div></div>
            <div class="ledstrip"><div id="topic_label" class="rot-neg-90"><strong>test</strong></div></div>
            <div class="ledstrip"><div id="topic_label" class="rot-neg-90"><strong>test</strong></div></div>
            <div class="ledstrip"><div id="topic_label" class="rot-neg-90"><strong>test</strong></div></div>
            <div class="ledstrip"><div id="topic_label" class="rot-neg-90"><strong>test</strong></div></div>
            </div>
        </div>

        <div style="padding:2em;margin-top: 15px;">
            <p id="key"><strong>WHAT DO THE COLORS MEAN?</strong></p>
            <div style="width:25%;float: left">
            <div><div class="circle" style="background-color: #00FF00;"></div>&nbsp;<span style="color:#07B918;float:left;line-height:18px;margin-left:5px;vertical-align:middle">Joviality</span></div>
            <div><div class="circle" style="background-color: #FF00FF"></div>&nbsp;<span style="color:#953735;float:left;line-height:18px;margin-left:5px;vertical-align:middle">Fatigue</span></div>
            </div>
            <div style="width:25%;float: left">
            <div><div class="circle" style="background-color: #FF0000"></div>&nbsp;<span style="color:#E10000;float:left;line-height:18px;margin-left:5px;vertical-align:middle">Hostility</span></div>
            <div><div class="circle" style="background-color: #0000FF"></div>&nbsp;<span style="color:#21375E;float:left;line-height:18px;margin-left:5px;vertical-align:middle">Sadness</span></div>
            </div>
            <div style="width:25%;float: left">
            <div><div class="circle" style="background-color: #00FFFF"></div>&nbsp;<span style="color:#31859C;float:left;line-height:18px;margin-left:5px;vertical-align:middle">Serenity</span></div>
            <div><div class="circle" style="background-color: #FFFF00"></div>&nbsp;<span style="color:#FFB700;float:left;line-height:18px;margin-left:5px;vertical-align:middle">Fear</span></div>
            </div>
            <div style="width:25%;float: left">
            <div><div class="circle" style="background-color: #FF8000"></div>&nbsp;<span style="color:#E06B0A;float:left;line-height:18px;margin-left:5px;vertical-align:middle">Guilt</span></div>
            </div>
        </div>
        </div>   
    <footer>
        <div class="technical_info">
        <span id="ipaddr" style="font-size:x-small">MoodCloud IP: {{IP}}</span>
        <span id="mcip_updated" style="font-size:xx-small;font-style:italic">Last seen: {{IP_updated}}</span>
        </div>
        <a href="https://github.com/irjudson/moodcloud">MoodCloud</a> is maintained by <a href="http://www.wesense.co/">Melissa Quintanilha</a>, <a href="http://www.irjudson.org/">Ivan R. Judson</a>, Jaime Teevan, Shelly Farnham and Christopher Rampey.
    </footer>       
    </div>
</div>
<script type="text/javascript">
var strip = new Array();
var animation = new Array(); // need to be global

function executeQuery() {
    $.ajax({
    url: '/data/',
    success: function(data) {
        if (data) {
            //console.log(data['fields']);
            //console.log(data['fields']['search_term']);
            if (data.hasOwnProperty('fields') && data['fields'].hasOwnProperty('topics')) {
                for(var i=0; i<data['fields']['topics'].length; i++) {
                var topic = data['fields']['topics'][i]['fields'];
                    //console.log(topic['topic']+" : "+topic['mood']['fields']['label']+" "+topic['mood']['fields']['color']);
                    var hex = topic['mood']['fields']['color'];
                    var rgb = [parseInt(hex.slice(1,3), 16), parseInt(hex.slice(3,5), 16), parseInt(hex.slice(5), 16)];
                    //console.log("RGB: "+rgb);
                    strip[i].clear();
                    $('#topic_label.rot-neg-90 strong')[i].innerText = topic['topic'];
                    for (var j=0;j<6;j++) {
                        var idx = i*6+j;
                        strip[i].buffer[j] = rgb;
                        //console.log("Setting title of " + i + "," +j+" to " + topic['topic']);
                        var s = $(".ledstrip")[i];
                        //console.log(s);
                        var l = $(s).find(".WS2812-led")[j];
                        //console.log(l);
                        l.title = topic['topic'];
                    }
                    strip[i].send();
                    }
                }
                }
        //console.log("Updated from whooly.");
        },
        error: function() {
        console.log("There was an error retrieving data for moodcloud.");
        }
    });
}

$(document).ready(function(){
  $('.ledstrip').each(function(index, value) {
    strip[index] = LEDstrip(value, 6, "vertical");
  });
  $().tooltip();
  setInterval(executeQuery, 1000);
});
</script>
</body>
</html>